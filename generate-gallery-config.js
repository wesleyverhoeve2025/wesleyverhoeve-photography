const fs = require('fs');
const path = require('path');

const WORK_DIR = path.join(__dirname, 'work');
const OUTPUT_FILE = path.join(__dirname, 'gallery-config.js');
const IMAGE_EXTENSIONS = ['.jpg', '.jpeg', '.png', '.webp', '.JPG'];

function isImageFile(filename) {
    return IMAGE_EXTENSIONS.includes(path.extname(filename));
}

function getGalleryImages(folder) {
    const dirPath = path.join(WORK_DIR, folder);
    if (!fs.existsSync(dirPath)) return [];
    return fs.readdirSync(dirPath)
        .filter(f => isImageFile(f))
        .map(f => `work/${folder}/${f}`);
}

function main() {
    const galleries = {};
    const folders = fs.readdirSync(WORK_DIR).filter(f => {
        const fullPath = path.join(WORK_DIR, f);
        return fs.statSync(fullPath).isDirectory();
    });
    folders.forEach(folder => {
        // Use folder name as key, but replace spaces and make lowercase for consistency
        const key = folder
            .replace(/\s+/g, '-')
            .replace(/-+/g, '-')
            .toLowerCase();
        galleries[key] = getGalleryImages(folder);
    });

    // Write to gallery-config.js
    const output =
        '// This file is auto-generated by generate-gallery-config.js\n' +
        'window.galleryConfig = ' + JSON.stringify(galleries, null, 4) + ';\n';
    fs.writeFileSync(OUTPUT_FILE, output);
    console.log('gallery-config.js updated!');
}

main(); 